---
- name: Bring up docker containers
  hosts: localhost
  gather_facts: false
  vars:
    inventory:
      - name: ufw_host_1
        image: "ubuntu-upstart:14.04"
  roles:
    - role: provision_docker
      provision_docker_inventory: "{{ inventory }}"

- name: Run ufw tests
  hosts: docker_containers
  vars:
    ufw_allow_ipv6: "no"
    ufw_ssh_port: 2222
    ufw_rules:
        - { rule: 'limit', port: '{{ ufw_ssh_port | default("22") }}', proto: 'tcp' }
        - { rule: 'allow', port: '2000', proto: 'udp' }
        - { rule: 'allow', port: '25', proto: 'tcp' }
  roles:
    - role: ufw-role
  tasks:
    - name: Test ports
      command: 'echo "Hello world"'